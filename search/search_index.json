{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Ghibli Movie Application","text":""},{"location":"#architecture-overview","title":"Architecture Overview","text":""},{"location":"#application-code-reference","title":"Application Code Reference","text":"<p>Ghibli Movie Booking System</p> <p>This Flask application provides a simple web interface for customers to log in, view their personal details and bookings, and update extra requests for courses.</p> <p>Note: This is a basic implementation with temporary in-memory data.</p>"},{"location":"#app.admin_dashboard","title":"<code>admin_dashboard()</code>","text":"<p>Display admin dashboard.</p> <p>Returns:</p> Name Type Description <code>str</code> <p>Rendered admin dashboard template</p> Source code in <code>app.py</code> <pre><code>@app.route(\"/admin\")\ndef admin_dashboard():\n    \"\"\"\n    Display admin dashboard.\n\n    Returns:\n        str: Rendered admin dashboard template\n    \"\"\"\n    return render_template(\"admin_dashboard.html\")\n</code></pre>"},{"location":"#app.booking","title":"<code>booking()</code>","text":"<p>Handle course booking.</p> Source code in <code>app.py</code> <pre><code>@app.route(\"/book\", methods=[\"GET\", \"POST\"])\ndef booking():\n    \"\"\"\n    Handle course booking.\n    \"\"\"\n    if session.get(\"role\") != \"customer\":\n        return redirect(url_for(\"customer_login\"))\n\n    if request.method == \"POST\":\n        # Check if already booked\n        already_booked = any(\n            b[\"email\"] == session[\"email\"]\n            and b[\"course\"] == \"Moving Castle Creations - 3D Animation\"\n            for b in BOOKINGS\n        )\n\n        if already_booked:\n            return redirect(url_for(\"customer_dashboard\"))\n\n        # Process new booking\n        selected_modules = request.form.getlist(\"modules\")\n        extra = request.form.get(\"extra\", \"\")\n\n        booking_data = {\n            \"email\": session.get(\"email\"),\n            \"course\": \"Moving Castle Creations - 3D Animation\",\n            \"modules\": selected_modules,\n            \"extra\": extra,\n        }\n\n        BOOKINGS.append(booking_data)\n        session[\"last_booking\"] = booking_data\n\n        return redirect(url_for(\"booking_submitted\"))\n\n    return render_template(\n        \"booking.html\",\n        user={\n            \"name\": session.get(\"name\"),\n            \"email\": session.get(\"email\"),\n            \"phone\": session.get(\"phone\"),\n        },\n    )\n</code></pre>"},{"location":"#app.booking_submitted","title":"<code>booking_submitted()</code>","text":"<p>Display booking confirmation page.</p> <p>Shows the details of the most recently submitted booking. Requires authentication.</p> <p>Returns:</p> Name Type Description <code>str</code> <p>Rendered booking confirmation template or redirect</p> Source code in <code>app.py</code> <pre><code>@app.route(\"/booking-submitted\")\ndef booking_submitted():\n    \"\"\"\n    Display booking confirmation page.\n\n    Shows the details of the most recently submitted booking.\n    Requires authentication.\n\n    Returns:\n        str: Rendered booking confirmation template or redirect\n    \"\"\"\n    if session.get(\"role\") != \"customer\":\n        return redirect(url_for(\"customer_login\"))\n\n    booking_data = session.get(\"last_booking\")\n\n    if not booking_data:\n        return redirect(url_for(\"booking\"))\n\n    return render_template(\n        \"booking_submitted.html\",\n        booking_data=booking_data,\n        module_labels=MODULE_LABELS,\n    )\n</code></pre>"},{"location":"#app.customer_dashboard","title":"<code>customer_dashboard()</code>","text":"<p>Display customer dashboard with personal details and bookings.</p> <p>Allows customers to view their information and update booking extras. Requires authentication.</p> <p>Returns:</p> Name Type Description <code>str</code> <p>Rendered dashboard template or redirect to login</p> Source code in <code>app.py</code> <pre><code>@app.route(\"/dashboard\", methods=[\"GET\", \"POST\"])\ndef customer_dashboard():\n    \"\"\"\n    Display customer dashboard with personal details and bookings.\n\n    Allows customers to view their information and update booking extras.\n    Requires authentication.\n\n    Returns:\n        str: Rendered dashboard template or redirect to login\n    \"\"\"\n    if session.get(\"role\") != \"customer\":\n        return redirect(url_for(\"customer_login\"))\n\n    user_email = session.get(\"email\")\n\n    if request.method == \"POST\":\n        course_to_update = request.form[\"course\"]\n        new_extra = request.form[\"extra\"]\n\n        for booking_item in BOOKINGS:\n            if (\n                booking_item[\"email\"] == user_email\n                and booking_item[\"course\"] == course_to_update\n            ):\n                booking_item[\"extra\"] = new_extra\n                break\n\n    personal_details = {\n        \"name\": session.get(\"name\"),\n        \"email\": session.get(\"email\"),\n        \"phone\": session.get(\"phone\"),\n    }\n    # set cusor for db\n    db = get_db_connection()\n    cursor = db.cursor()\n    # set query for join booking customerid against customers table\n    query = \"\"\"\n    SELECT b.booking_id, b.course_id, b.nice_to_have_requests, b.status \n    FROM bookings b\n    JOIN customers c ON b.customer_id = c.customer_id\n    WHERE c.email = %s\n    \"\"\"\n    # execute and get rows\n    cursor.execute(query, (user_email,))\n    rows = cursor.fetchall()\n\n    # user_bookings = [b for b in BOOKINGS if b[\"email\"] == user_email]\n    user_bookings = []\n    for row in rows:\n        user_bookings.append({\n            \"booking_id\": row[0],\n            \"course\": row[1],               # Mapping course_id\n            \"extra\": row[2],                # Mapping nice_to_have_requests\n            \"status\": row[3]\n        })\n\n    return render_template(\n        \"customer_dashboard.html\",\n        personal_details=personal_details,\n        bookings=user_bookings,\n    )\n</code></pre>"},{"location":"#app.customer_login","title":"<code>customer_login()</code>","text":"<p>Handle customer login.</p> <p>GET: Display the login form POST: Process login credentials and create session</p> <p>Returns:</p> Name Type Description <code>str</code> <p>login template or redirect to dashboard POST</p> Source code in <code>app.py</code> <pre><code>@app.route(\"/login\", methods=[\"GET\", \"POST\"])\ndef customer_login():\n    \"\"\"\n    Handle customer login.\n\n    GET: Display the login form\n    POST: Process login credentials and create session\n\n    Returns:\n        str: login template or redirect to dashboard POST\n    \"\"\"\n    # POST checks password and fails or redirects to dashboard\n    if request.method == \"POST\":\n        email = request.form[\"email\"]\n        password = request.form[\"password\"]\n\n        # Read DB and check if we can find user\n        # Look up user in the database\n        try:\n            conn = get_db_connection()\n            cur = conn.cursor()\n            cur.execute(\n                \"\"\"\n                SELECT customer_id, name, last_name, email, phone, password\n                FROM customers\n                WHERE email = %s\n                \"\"\",\n                (email,),\n            )\n            row = cur.fetchone()\n            cur.close()\n            conn.close()\n        except Exception:\n            # For production, log this and show generic error\n            return \"Invalid login credentials\", 401\n        # check if row cursor was successful proceed else fail\n        if not row:\n            return \"Invalid login credentials\"\n        # success extract row data to variables\n        customer_id, first_name, last_name, email_db, phone, s_password = row\n        # Check if password matched else fail\n        if s_password != password:\n            return \"Invalid login credentials\"\n        # create full name varible and concantenate first and last name with space for memory db\n        name = f\"{first_name} {last_name}\"\n\n        # Set in memory array values\n        CUSTOMERS[email_db] = {\n            \"password\": s_password,\n            \"name\": name,\n            \"email\": email_db,\n            \"phone\": phone,\n        }\n        # Set session values used elsewhere\n        session[\"user\"] = email_db\n        session[\"role\"] = \"customer\"\n        session[\"name\"] = name\n        session[\"email\"] = email_db\n        session[\"phone\"] = phone\n\n        return redirect(url_for(\"customer_dashboard\"))\n    # GET sends login\n    return render_template(\"customer_login.html\")\n</code></pre>"},{"location":"#app.edit_booking","title":"<code>edit_booking(booking_id)</code>","text":"<p>Handle editing of bookings in admin panel.</p> <p>GET: Display the edit booking form POST: Process booking updates</p> <p>Parameters:</p> Name Type Description Default <code>booking_id</code> <code>int</code> <p>The ID of the booking to edit</p> required <p>Returns:</p> Name Type Description <code>str</code> <p>Rendered edit template or redirect to admin dashboard</p> Source code in <code>app.py</code> <pre><code>@app.route(\"/admin/bookings/&lt;int:booking_id&gt;/edit\", methods=[\"GET\", \"POST\"])\ndef edit_booking(booking_id):\n    \"\"\"\n    Handle editing of bookings in admin panel.\n\n    GET: Display the edit booking form\n    POST: Process booking updates\n\n    Args:\n        booking_id (int): The ID of the booking to edit\n\n    Returns:\n        str: Rendered edit template or redirect to admin dashboard\n    \"\"\"\n\n    if request.method == \"POST\":\n        return redirect(url_for(\"admin_dashboard\"))\n\n    return render_template(\"edit_booking.html\", booking_id=booking_id)\n</code></pre>"},{"location":"#app.get_db_connection","title":"<code>get_db_connection()</code>","text":"<p>Parse DATABASE_URL (from Docker Compose) and connect securely.</p> Source code in <code>app.py</code> <pre><code>def get_db_connection():\n    \"\"\"\n    Parse DATABASE_URL (from Docker Compose) and connect securely.\n    \"\"\"\n    database_url = os.environ.get(\"DATABASE_URL\")\n    if not database_url:\n        raise ValueError(\"DATABASE_URL environment variable is required\")\n\n    # Parse postgresql://user:pass@host:port/dbname\n    parsed = urlparse(database_url)\n\n    return psycopg2.connect(\n        host=parsed.hostname,\n        port=parsed.port or 5432,\n        dbname=parsed.path[1:],  # Remove leading '/'\n        user=parsed.username,\n        password=parsed.password,\n    )\n</code></pre>"},{"location":"#app.index","title":"<code>index()</code>","text":"<p>Render the landing page.</p> <p>Returns:</p> Name Type Description <code>str</code> <p>Rendered HTML template for the index page</p> Source code in <code>app.py</code> <pre><code>@app.route(\"/\")\ndef index():\n    \"\"\"\n    Render the landing page.\n\n    Returns:\n        str: Rendered HTML template for the index page\n    \"\"\"\n    return render_template(\"index.html\")\n</code></pre>"},{"location":"#app.logout","title":"<code>logout()</code>","text":"<p>Log out the current user by clearing the session.</p> <p>Returns:</p> Type Description <p>werkzeug.wrappers.Response: Redirect to login page</p> Source code in <code>app.py</code> <pre><code>@app.route(\"/logout\")\ndef logout():\n    \"\"\"\n    Log out the current user by clearing the session.\n\n    Returns:\n        werkzeug.wrappers.Response: Redirect to login page\n    \"\"\"\n    session.clear()\n    return redirect(url_for(\"customer_login\"))\n</code></pre>"},{"location":"#app.register","title":"<code>register()</code>","text":"<p>Handle customer registration.</p> <p>GET: Display the registration form POST: Process registration and create new customer account</p> <p>Returns:</p> Name Type Description <code>str</code> <p>Rendered registration template or redirect to login</p> Source code in <code>app.py</code> <pre><code>@app.route(\"/register\", methods=[\"GET\", \"POST\"])\ndef register():\n    \"\"\"\n    Handle customer registration.\n\n    GET: Display the registration form\n    POST: Process registration and create new customer account\n\n    Returns:\n        str: Rendered registration template or redirect to login\n    \"\"\"\n    if request.method == \"POST\":\n        first_name = request.form[\"first_name\"]\n        last_name = request.form[\"last_name\"]\n        name = first_name + \" \" + last_name\n        email = request.form[\"email\"]\n        phone = request.form[\"phone\"]\n        password = request.form[\"password\"]\n        confirm_password = request.form[\"confirm_password\"]\n\n        # Check passwords match\n        if password != confirm_password:\n            return \"Passwords do not match\"\n\n        # Save new user in memory\n        CUSTOMERS[email] = {\n            \"password\": password,\n            \"name\": name,\n            \"email\": email,\n            \"phone\": \"N/A\",\n        }\n        # Insert into customers table\n        try:\n            conn = get_db_connection()\n            cur = conn.cursor()\n            cur.execute(\n                \"\"\"\n                INSERT INTO customers (name, last_name, email, phone, created_at, password)\n                VALUES (%s, %s, %s, %s, CURRENT_TIMESTAMP, %s)\n                \"\"\",\n                (first_name, last_name, email, phone, password),\n            )\n            conn.commit()\n            cur.close()\n            conn.close()\n        except Exception as e:\n            # For production, log this instead of returning raw error\n            return f\"Error creating account: {e}\", 500\n\n        return redirect(url_for(\"customer_login\"))\n\n    return render_template(\"register.html\")\n</code></pre>"},{"location":"databasetables/","title":"Databasetables","text":"<p>Password for user ghibli_adm: psql (16.11 (Ubuntu 16.11-0ubuntu0.24.04.1)) SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, compression: off) Type \"help\" for help.</p> <p>ghibli_booking=&gt; CREATE TYPE booking_status AS ENUM ('pending', 'approved', 'cancelled'); CREATE TYPE admin_role AS ENUM ('admin', 'editor', 'viewer'); CREATE TYPE CREATE TYPE ghibli_booking=&gt; CREATE TABLE customers (   customer_id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,   first_name  TEXT NOT NULL,   last_name   TEXT NOT NULL,   email       TEXT NOT NULL UNIQUE,   phone       TEXT,   created_at  TIMESTAMPTZ NOT NULL DEFAULT now() ); CREATE TABLE ghibli_booking=&gt; CREATE TABLE admins (   admin_id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,   name     TEXT NOT NULL,   email    TEXT NOT NULL,   role     TEXT NOT NULL ); CREATE TABLE ghibli_booking=&gt; CREATE TABLE courses (   course_id    BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,   course_name  TEXT NOT NULL UNIQUE,   description  TEXT NOT NULL,   active       BOOLEAN NOT NULL DEFAULT true,   created_at   TIMESTAMPTZ NOT NULL DEFAULT now() ); CREATE TABLE ghibli_booking=&gt; CREATE TABLE course_modules (   module_id          BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,   course_id          BIGINT NOT NULL,   module_name        TEXT NOT NULL,   module_description TEXT,   module_order       INTEGER,   active             BOOLEAN NOT NULL DEFAULT true,   CONSTRAINT fk_course_modules_course     FOREIGN KEY (course_id) REFERENCES courses(course_id) ); CREATE TABLE ghibli_booking=&gt; CREATE TABLE bookings (   booking_id             BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,   customer_id            BIGINT NOT NULL,   course_id              BIGINT NOT NULL,   nice_to_have_requests  TEXT,   status                 TEXT NOT NULL,   locked                 BOOLEAN NOT NULL DEFAULT false,   submitted_at           TIMESTAMPTZ NOT NULL DEFAULT now(),   updated_at             TIMESTAMPTZ NOT NULL DEFAULT now(),   CONSTRAINT fk_bookings_customer     FOREIGN KEY (customer_id) REFERENCES customers(customer_id),   CONSTRAINT fk_bookings_course     FOREIGN KEY (course_id) REFERENCES courses(course_id) ); CREATE TABLE ghibli_booking=&gt; CREATE TABLE booking_modules (   booking_id BIGINT NOT NULL,   module_id  BIGINT NOT NULL,   PRIMARY KEY (booking_id, module_id),   CONSTRAINT fk_booking_modules_booking     FOREIGN KEY (booking_id) REFERENCES bookings(booking_id),   CONSTRAINT fk_booking_modules_module     FOREIGN KEY (module_id) REFERENCES course_modules(module_id) ); CREATE TABLE</p>"}]}